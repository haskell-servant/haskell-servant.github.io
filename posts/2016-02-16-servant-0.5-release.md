
Quite a lot of exciting changes have happened in since the last major release.
The breaking changes are:

 - Trie-based routing (Andres)
 - Proper error handling (Andres)
 - `Config` machinery (Sönke/Julian)
 - `http-api-data` (Nickolay)
 - Simplify `ToSample` (Nickolay)
 - Unifying method combinators (Julian)
 - Non-memoized request body (Julian)
 - Remove matrix params (Julian)
 - `Manager` and `BaseUrl` as an argument to client (Julian)
 - Switch from `EitherT to `ExceptT`
 - `NoContent` rather than `()` (Julian)
 - `servant-foreign` (Denis)
 - `servant-js` (freezeboy)

# Trie-based routing

Previously routing was *O(n)* in the number of routes, as we matched them
sequentially (and indeed, bodies would sometimes be deserialized more than
once). Andres improved this by transforming the routing into a trie.

# Proper error handling

One of the biggest embarassements for `servant` was the fact that in certain
circumstances, the HTTP error returned was not what one would expect. For
example, if a request had both the wrong method and the wrong body, the error
returned would be 400 (Bad Request) rather 405 (Method Not Allowed). This was
because we matched against parts of your API in the order they appeared in your
API type. Andres came up with an elegant solution to this problem, creating a
datatype that allows checks (and their side-effects) to be delayed.

As an added bonus, this machinery also allows captures (which require
attempting to deserialize an object) to be run *after* comparisons against
static paths, which is a nice optimization!

# `http-api-data`

The `FromText`/`ToText` have been renamed, revamped, and relocated. They are
now called `FromHttpApiData` and `ToHttpApiData` respectively, and exist in the
new package `http-api-data`. This was work by Nickolay Kudasov, and includes a
variety of other improvements. Most noticeably, rather than having a single
[de/]serialization method, there are now ones for each of the cases for which
we need the deserializaiton (this was based on an idea from Greg Weber):

   class FromHttpApiData a where
     {-# MINIMAL parseUrlPiece | parseQueryParam #-}
     parseUrlPiece :: Text -> Either Text a
     parseUrlPiece = parseQueryParam

     parseHeader :: ByteString -> Either Text a
     parseHeader = parseUrlPiece . decodeUtf8

     parseQueryParam :: Text -> Either Text a
     parseQueryParam = parseUrlPiece

The [haddocks](http://hackage.haskell.org/package/http-api-data-0.2.2/docs/Web-HttpApiData.html)
for the package have more information.

# Simplify `ToSample`

`ToSample` now takes only one parameter. It was an annoying mistake that it
ever took two, which Nickolay Kudasov fixed. Additionally, instead of having
two methods (`toSample` and `toSamples`) defined in terms of one another, we
now have a single one (`toSamples`).

    data MyData = MyData Int

    -- Old code
    instance ToSample MyData MyData where
      toSample _ = singleSample (MyData 42)

    instance ToSample MyData where
      toSamples _ = singleSample (MyData 42)

Nickolay also made a `Generic` default method for this class, so that now you
could simply have:

    data MyData = MyData Int deriving (Generic, ToSample)

# Unifying method combinators

Previously each of 'Get', 'Put', 'Post', etc. were entirely separate datatypes.
This also meant each interpretation needed to included instances for all of
them. The 0.5 release makes them instead type-synonyms:

    type Get  contentTypes a = Verb 'GET 200 contentTypes a

This makes it easy to change the status code of a success response. To further
facilitate that, we now provide a variety of other type synonyms for responses
other than 200.

# Non-memoized request body

Prior to Andres Löh's trie-based routing improvements, we had to keep the
request body in memory for more-or-less the duration of the request-response
cycle. This was of course far from ideal, but necessary given that we could not
tell whether the request might be re-routed to a different endpoint. After the
changes, we can now remove it. Note however that certain idioms, such as

    type API = ReqBody '[JSON] Int :> Get '[JSON] Int
          :<|> ReqBody '[JSON] String :> Get '[JSON] String

No longer make sense - a request body that cannot be decoded as an `Int` will
be rejected with a 400, and the second endpoint will not be tried. This accords
with the behaviour of more traditional frameworks and, as Edsko de Vries showed
in a [blog post](http://www.edsko.net/temp/dependently-typed-servers/), no loss
of expressivity is entailed by the change.

We expect this to enable streaming combinators.

# Remove matrix params

Matrix params were interacting poorly with the rest of `servant`, because they
necessitate special behaviour. We decided to remove them. If you were relying
on them and would like to see them back, please let us know.

# Switch from `EitherT` to `ExceptT`

Along with the rest of the world, we've moved to `ExceptT`, which is in `mtl`.
Updating should consist of just replacing all occurrences of `EitherT` with
`ExceptT`.

# `Manager` and `BaseUrl` as an argument

Previously the *http-client* manager was created (with `unsafePerformIO`) by
the *servant-client* library itself. This meant that it was impossible to
configure the `Manager`. Now the `Manager` is passed in as an argument to
client:

    -- Old code
    endpoint1 :<|> endpoint2 = client api
    -- endpoint1 :: BaseUrl -> X
    -- New code
    endpoint1 :<|> endpoint2 = client api baseUrl manager
    -- endpoint1 :: X

We're not entirely happy with this solution, since sometimes you want the
`endpoint1` functions to take these two arguments instead (for example, if you
would like to distribute client functions as a library). But it is an
improvement.
